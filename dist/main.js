(()=>{"use strict";const e=e=>{const t=document.getElementById(e),n=document.getElementById("form1-name"),r=document.querySelectorAll("button[type=submit]"),o=e[4]-1;r.forEach((e=>e.setAttribute("disabled","disabled"))),document.querySelectorAll("input").forEach((e=>e.addEventListener("input",(()=>{let e=0;for(let n of new FormData(t).entries())""===n[1]&&(e+=1);e||n.value.length<2?r[o].setAttribute("disabled","disabled"):r[o].removeAttribute("disabled")}))));const s=document.createElement("div");s.style.cssText="font-size: 2rem;",t.appendChild(s),t.addEventListener("submit",(e=>{e.preventDefault(),t.appendChild(s),s.textContent="Загрузка...";const n=new FormData(t);let r={};n.forEach(((e,t)=>{r[t]=e})),fetch("./server.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}).then((e=>{if(200!==e.status)throw new Error(`Что-то пошло не так, код ошибки - ${e.status}`);s.textContent="Спасибо! Мы скоро с вами свяжемся!",a()})).catch((e=>{console.log(e),s.textContent="Что-то пошло не так...",a()}))}));const a=()=>{l(t),s.style.cssText="",r[o].setAttribute("disabled","disabled"),setTimeout((()=>{s.textContent=""}),3e3),"form3"===e&&setTimeout((()=>{document.querySelector(".popup").style.display="none"}),2e3)},l=e=>{e.querySelectorAll("input").forEach((e=>e.value=""))}},t=class{constructor({selector:e,pattern:t={},method:n}){this.form=document.querySelector(e),this.pattern=t,this.method=n,this.elementsForm=[...this.form.elements].filter((e=>"button"!==e.tagName.toLowerCase()&&"button"!==e.type)),this.submitBtn=[...this.form.querySelectorAll("button")].reduce(((e,t)=>{if("submit"===t.type)return t})),this.error=new Set,this.form.setAttribute("novalidate",""),this.submitBtn.setAttribute("disabled","")}init(){this.applyStyle(),this.setPattern(),this.elementsForm.forEach((e=>e.addEventListener("input",this.checkIt.bind(this)))),this.form.addEventListener("submit",(e=>{this.elementsForm.forEach((e=>this.checkIt({target:e}))),e.preventDefault(),this.error.size&&this.submitBtn.setAttribute("disabled","")}))}isValid(e){const t={notEmpty:e=>""!==e.value.trim(),pattern:(e,n)=>!t.notEmpty(e)||n.test(e.value)};if(this.method){const n=this.method[e.type];if(n)return n.every((n=>t[n[0]](e,this.pattern[n[1]])))}return!0}checkIt(e){this.elementsForm.forEach((e=>{this.isValid(e)?(this.showSuccess(e),this.error.delete(e),this.error.size||this.form.querySelector("button").removeAttribute("disabled","")):(this.showError(e),this.error.add(e),this.error.size&&this.form.querySelector("button").setAttribute("disabled",""))}))}showError(e){if(e.classList.remove("success"),e.classList.add("error"),e.nextElementSibling&&e.nextElementSibling.classList.contains("validator-error"))return;const t=document.createElement("div");t.textContent="Некорректные данные",t.classList.add("validator-error"),e.insertAdjacentElement("afterend",t)}showSuccess(e){e.classList.remove("error"),e.classList.add("success"),e.nextElementSibling&&e.nextElementSibling.classList.contains("validator-error")&&e.nextElementSibling.remove()}applyStyle(){const e=document.createElement("style");e.textContent="\n      input.success {\n        border: 2 px solid green !important;\n      }\n      input.error {\n        border: 2 px solid red !important;\n      }\n      .validator-error {\n        color: red;\n      }\n    ",document.head.append(e)}setPattern(){this.pattern.phone||(this.pattern.phone=/.{17}/),this.pattern.email||(this.pattern.email=/^\w+@\w+\.\w{2,}$/)}};new t({selector:"#form1",method:{tel:[["notEmpty"],["pattern","phone"]],email:[["notEmpty"],["pattern","email"]],text:[["notEmpty"]]}}).init(),new t({selector:"#form2",method:{tel:[["notEmpty"],["pattern","phone"]],email:[["notEmpty"],["pattern","email"]],text:[["notEmpty"]]}}).init(),new t({selector:"#form3",method:{tel:[["notEmpty"],["pattern","phone"]],email:[["notEmpty"],["pattern","email"]],text:[["notEmpty"]]}}).init(),function(e,t="+7 (___) ___-__-__"){const n=document.querySelectorAll(e);function r(e){const n=e.keyCode,r=t,o=r.replace(/\D/g,""),s=this.value.replace(/\D/g,"");let a=0,l=r.replace(/[_\d]/g,(function(e){return a<s.length?s.charAt(a++)||o.charAt(a):e}));a=l.indexOf("_"),-1!=a&&(l=l.slice(0,a));let i=r.substr(0,this.value.length).replace(/_+/g,(function(e){return"\\d{1,"+e.length+"}"})).replace(/[+()]/g,"\\$&");i=new RegExp("^"+i+"$"),(!i.test(this.value)||this.value.length<5||n>47&&n<58)&&(this.value=l),"blur"==e.type&&this.value.length<5&&(this.value="")}for(const e of n)e.addEventListener("input",r),e.addEventListener("focus",r),e.addEventListener("blur",r)}(".form-phone"),function(){let e=new Date,t=`${e.getFullYear()}-${e.getMonth()+1}-${e.getDate()+1}`,n=document.querySelector("#timer-hours"),r=document.querySelector("#timer-minutes"),o=document.querySelector("#timer-seconds");function s(){let n=(new Date(t).getTime()-(new Date).getTime())/1e3;return Math.floor(n/60/60)-24+24<0?(e=new Date,void(t=`${e.getFullYear()}-${e.getMonth()+1}-${e.getDate()+1}`)):function(e,...t){t=t.map((e=>e<10?"0"+e:""+e));let[r,o,s]=[...t];return{timeRemaining:n,seconds:r,minutes:o,hours:s}}(0,Math.floor(n%60),Math.floor(n/60%60),Math.floor(n/60/60))}let a=s();n.textContent=a.hours,r.textContent=a.minutes,o.textContent=a.seconds;const l=setInterval((()=>{let e=s();void 0!==e?(n.textContent=e.hours,r.textContent=e.minutes,o.textContent=e.seconds,e.timeRemaining<=1&&clearInterval(l)):clearInterval(l)}),1e3)}(),(()=>{const e=document.querySelector("menu"),t=()=>e.classList.toggle("active-menu");function n(e,t){const n=e.offsetTop;let r,o=0;r=requestAnimationFrame((function e(){var s;r=requestAnimationFrame(e),s=t,o>.95*n&&1!==s?s/=2:n>4e3?s+=3:n>3e3&&(s+=2),o+=20*s,document.documentElement.scrollTop=o,o>n&&(document.documentElement.scrollTop=n,cancelAnimationFrame(r))}))}document.addEventListener("click",(r=>{let o=r.target;if(o.closest("main")&&!e.classList.contains("active-menu"))o.closest(".menu")?t():o.closest('a[href="#service-block"]')&&(r.preventDefault(),n(document.getElementById("service-block"),2));else if(e.classList.contains("active-menu"))if(null===o.closest("menu")||o.classList.contains("close-btn"))t();else if("A"===o.tagName&&!o.classList.contains(".close-btn")){r.preventDefault(),t();const e=o.getAttribute("href").substring(1);n(document.getElementById(e),3)}}))})(),(()=>{const e=document.querySelector(".popup"),t=document.querySelectorAll(".popup-btn"),n=document.querySelector(".popup-close"),r=e.querySelector("form"),o=e.querySelector("div");let s=0;function a(){e.style.display="block",o.style.transform="scale(0)",document.documentElement.clientWidth>=768?(s+=10,o.style.transform=`scale(${s/100})`,s<=100&&requestAnimationFrame(a)):o.style.transform="scale(1)"}function l(){e.style.display="none",s=0}t.forEach((e=>{e.addEventListener("click",(()=>{requestAnimationFrame(a)}))})),e.addEventListener("click",(t=>{t.target!==e&&t.target!==n||l()})),r.addEventListener("submit",l)})(),(()=>{const e=document.querySelector(".service-header"),t=e.querySelectorAll(".service-header-tab"),n=document.querySelectorAll(".service-tab");e.addEventListener("click",(e=>{let r=e.target;r=r.closest(".service-header-tab"),r&&t.forEach(((e,o)=>{e===r&&(e=>{for(let r=0;r<n.length;r++)e===r?(t[r].classList.add("active"),n[r].classList.remove("d-none")):(t[r].classList.remove("active"),n[r].classList.add("d-none"))})(o)}))}))})(),(()=>{const e=document.querySelectorAll(".portfolio-item"),t=document.querySelector(".portfolio-dots"),n=document.querySelector(".portfolio-content");let r,o=0;e.forEach((e=>{let n=document.createElement("li");n.classList.add("dot"),0===e&&n.classList.add("dot-active"),t.appendChild(n)}));const s=document.querySelectorAll(".dot"),a=(e,t,n)=>{e[t].classList.remove(n)},l=(e,t,n)=>{e[t].classList.add(n)},i=()=>{a(e,o,"portfolio-item-active"),a(s,o,"dot-active"),o++,o>=e.length&&(o=0),l(e,o,"portfolio-item-active"),l(s,o,"dot-active")},c=(e=3e3)=>{r=setInterval(i,e)};n.addEventListener("click",(t=>{t.preventDefault();let n=t.target;n.matches(".portfolio-btn, .dot")&&(a(e,o,"portfolio-item-active"),a(s,o,"dot-active"),n.matches("#arrow-right")?o++:n.matches("#arrow-left")?o--:n.matches(".dot")&&s.forEach(((e,t)=>{e===n&&(o=t)})),o>=e.length&&(o=0),o<0&&(o=e.length-1),l(e,o,"portfolio-item-active"),l(s,o,"dot-active"))})),n.addEventListener("mouseover",(e=>{(e.target.matches(".portfolio-btn")||e.target.matches(".dot"))&&clearInterval(r)})),n.addEventListener("mouseout",(e=>{(e.target.matches(".portfolio-btn")||e.target.matches(".dot"))&&c()})),c(1500)})(),document.querySelectorAll("#command .command__photo").forEach((e=>{const t=e.getAttribute("src"),n=e.dataset.img;e.addEventListener("mouseenter",(e=>e.target.src=n)),e.addEventListener("mouseleave",(e=>e.target.src=t))})),(()=>{let e=!1;document.getElementById("form1-name");const t=n=>{n.target.value=n.target.value.replace(/-+(?=-+)| +(?= +)|-+(?= +)| +(?=-+)|^ +| +$|^-+|-+$/gi,""),("user_name"===n.target.name||n.target.value.length<2)&&(n.target.value=n.target.value.split(" ").map((e=>e[0].toUpperCase()+e.slice(1).toLowerCase())).join(" ")),n.target.removeEventListener("blur",t),e=!e},n=n=>{e||(n.target.addEventListener("blur",t),e=!e)};document.addEventListener("input",(e=>{e.target.matches("input.calc-item")?(e=>{e.target.value=e.target.value.replace(/\D/gi,""),n(e)})(e):"email"===e.target.type?(e=>{e.target.value=e.target.value.replace(/[^a-z@_.!~*'-]/gi,""),n(e)})(e):"tel"===e.target.type?(e=>{e.target.value=e.target.value.replace(/[^\d-()+]/gi,"")})(e):e.target.matches(".mess")?(e=>{e.target.value=e.target.value.replace(/[^а-я- ,.!?'()0-9]/gi,""),n(e)})(e):("text"===e.target.type||e.target.matches("input"))&&(e=>{e.target.value=e.target.value.replace(/[^а-я- ]|-(?=-)| (?= )/gi,""),n(e)})(e)}))})(),((e=100)=>{const t=document.querySelector(".calc-block"),n=document.querySelector(".calc-type"),r=document.querySelector(".calc-square"),o=document.querySelector(".calc-day"),s=document.querySelector(".calc-count"),a=document.getElementById("total");t.addEventListener("change",(t=>{const l=t.target;(l.matches("select")||l.matches("input"))&&(()=>{let t=0,l=1,i=1;const c=n.options[n.selectedIndex].value,u=+r.value;s.value>1&&(l+=(s.value-1)/10),o.value&&o.value<5?i*=2:o.value&&o.value<10&&(i*=1.5),c&&u&&(t=Math.round(e*c*u*l*i));let m=1;const d=()=>{const e=requestAnimationFrame(d);m*=2,a.textContent=m,m>=t&&(a.textContent=t,cancelAnimationFrame(e))};requestAnimationFrame(d),a.textContent=t})()}))})(100),e("form1"),e("form2"),e("form3")})();